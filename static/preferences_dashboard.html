<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>لوحة تحكم التفضيلات</title>
    <link rel="stylesheet" href="/static/dashboard_style.css">
    <script src="/static/dashboard_protect.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <h1>إدارة التفضيلات</h1>
        <div class="crud-table">
            <table>
                <thead>
                    <tr>
                        <th>المعرف</th>
                        <th>المستخدم</th>
                        <th>نوع التفضيل</th>
                        <th>القيمة</th>
                        <th>تاريخ</th>
                        <th>إجراءات</th>
                    </tr>
                </thead>
                <tbody id="preferences-table-body">
                    <tr>
                        <td>1</td>
                        <td>user@email.com</td>
                        <td>لغة</td>
                        <td>العربية</td>
                        <td>2025-06-20</td>
                        <td>
                            <button class="edit-btn">تعديل</button>
                            <button class="delete-btn">حذف</button>
                        </td>
                    </tr>
                </tbody>
            </table>
            <button class="add-btn">إضافة تفضيل جديد</button>
        </div>
    </div>
    <script>
    async function fetchPreferences() {
        const token = localStorage.getItem('access_token');
        const tbody = document.getElementById('preferences-table-body');
        tbody.innerHTML = '<tr><td colspan="6">جاري التحميل...</td></tr>';
        try {
            const res = await fetch('/api/user/preferences/', {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            if (!res.ok) throw new Error('فشل في جلب التفضيلات');
            const prefs = await res.json();
            tbody.innerHTML = '';
            if (!prefs || Object.keys(prefs).length === 0) {
                tbody.innerHTML = '<tr><td colspan="6">لا توجد تفضيلات</td></tr>';
                return;
            }
            // مثال: عرض تفضيلات السعر والعلامات التجارية
            tbody.innerHTML += `
                <tr>
                    <td>-</td>
                    <td>-</td>
                    <td>السعر الأدنى</td>
                    <td>${prefs.min_price || ''}</td>
                    <td>${prefs.created_at || ''}</td>
                    <td></td>
                </tr>`;
            tbody.innerHTML += `
                <tr>
                    <td>-</td>
                    <td>-</td>
                    <td>السعر الأعلى</td>
                    <td>${prefs.max_price || ''}</td>
                    <td>${prefs.created_at || ''}</td>
                    <td></td>
                </tr>`;
            if (prefs.brand_preferences && Array.isArray(prefs.brand_preferences)) {
                for (const bp of prefs.brand_preferences) {
                    tbody.innerHTML += `
                        <tr>
                            <td>-</td>
                            <td>-</td>
                            <td>علامة مفضلة</td>
                            <td>${bp.brand?.name || ''}</td>
                            <td>${bp.created_at || ''}</td>
                            <td></td>
                        </tr>`;
                }
            }
        } catch (e) {
            tbody.innerHTML = '<tr><td colspan="6">حدث خطأ في جلب البيانات</td></tr>';
        }
    }
    fetchPreferences();
    </script>
</body>
</html>
